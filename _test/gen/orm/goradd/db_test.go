// Code generated by goradd-orm. DO NOT EDIT.

package goradd

import (
	"bufio"
	"bytes"
	"fmt"
	"os"
	"testing"

	"github.com/goradd/orm/_test/gen/orm/goradd/node"
	"github.com/goradd/orm/pkg/db"
	"github.com/goradd/orm/pkg/test"
	"github.com/stretchr/testify/assert"
)

func TestMain(m *testing.M) {
	os.Exit(runTests(m))
}

func runTests(m *testing.M) int {
	setup(m)
	defer teardown()
	return m.Run()
}

func setup(m *testing.M) {
	fmt.Println("Setting up tests...")

	//fmt.Println(test.NewSeed())

	// uncomment the next line to re-use a previously created seed to recreate a test
	test.UseSeed(1000)

	InitDB()
}

func teardown() {
	// Cleanup logic here
	fmt.Println("Cleaning up after tests...")
}

// TestDbJson will export the entire database as JSON into a memory buffer, clear the database, then
// import the entire database from the buffer. It will then do some sanity checks.
func TestDbJson(t *testing.T) {
	return
	ctx := db.NewContext(nil)

	// get single comparison objects and data sizes
	// database must be pre-populated for test

	v_Gift, _ := QueryGifts(ctx).OrderBy(node.Gift().PrimaryKey()).Get()                               // gets first record
	v_Person, _ := QueryPeople(ctx).OrderBy(node.Person().PrimaryKey()).Get()                          // gets first record
	v_PersonWithLock, _ := QueryPersonWithLocks(ctx).OrderBy(node.PersonWithLock().PrimaryKey()).Get() // gets first record
	v_Project, _ := QueryProjects(ctx).OrderBy(node.Project().PrimaryKey()).Get()                      // gets first record
	v_Address, _ := QueryAddresses(ctx).OrderBy(node.Address().PrimaryKey()).Get()                     // gets first record
	v_EmployeeInfo, _ := QueryEmployeeInfos(ctx).OrderBy(node.EmployeeInfo().PrimaryKey()).Get()       // gets first record
	v_Login, _ := QueryLogins(ctx).OrderBy(node.Login().PrimaryKey()).Get()                            // gets first record
	v_Milestone, _ := QueryMilestones(ctx).OrderBy(node.Milestone().PrimaryKey()).Get()                // gets first record
	v_GiftCount, _ := CountGifts(ctx)
	v_PersonCount, _ := CountPeople(ctx)
	v_PersonWithLockCount, _ := CountPersonWithLocks(ctx)
	v_ProjectCount, _ := CountProjects(ctx)
	v_AddressCount, _ := CountAddresses(ctx)
	v_EmployeeInfoCount, _ := CountEmployeeInfos(ctx)
	v_LoginCount, _ := CountLogins(ctx)
	v_MilestoneCount, _ := CountMilestones(ctx)

	var b bytes.Buffer
	w := bufio.NewWriter(&b)
	assert.NoError(t, JsonEncodeAll(ctx, w))

	ClearAll(ctx)
	assert.Equal(t, 0, func() int { i, _ := CountGifts(ctx); return i }())
	assert.Equal(t, 0, func() int { i, _ := CountPeople(ctx); return i }())
	assert.Equal(t, 0, func() int { i, _ := CountPersonWithLocks(ctx); return i }())
	assert.Equal(t, 0, func() int { i, _ := CountProjects(ctx); return i }())
	assert.Equal(t, 0, func() int { i, _ := CountAddresses(ctx); return i }())
	assert.Equal(t, 0, func() int { i, _ := CountEmployeeInfos(ctx); return i }())
	assert.Equal(t, 0, func() int { i, _ := CountLogins(ctx); return i }())
	assert.Equal(t, 0, func() int { i, _ := CountMilestones(ctx); return i }())

	r := bufio.NewReader(&b)
	assert.NoError(t, JsonDecodeAll(ctx, r))

	if v_Gift != nil {
		obj, _ := QueryGifts(ctx).OrderBy(node.Gift().PrimaryKey()).Get()
		assertEqualFieldsGift(t, v_Gift, obj)
	}
	if v_Person != nil {
		obj, _ := QueryPeople(ctx).OrderBy(node.Person().PrimaryKey()).Get()
		assertEqualFieldsPerson(t, v_Person, obj)
	}
	if v_PersonWithLock != nil {
		obj, _ := QueryPersonWithLocks(ctx).OrderBy(node.PersonWithLock().PrimaryKey()).Get()
		assertEqualFieldsPersonWithLock(t, v_PersonWithLock, obj)
	}
	if v_Project != nil {
		obj, _ := QueryProjects(ctx).OrderBy(node.Project().PrimaryKey()).Get()
		assertEqualFieldsProject(t, v_Project, obj)
	}
	if v_Address != nil {
		obj, _ := QueryAddresses(ctx).OrderBy(node.Address().PrimaryKey()).Get()
		assertEqualFieldsAddress(t, v_Address, obj)
	}
	if v_EmployeeInfo != nil {
		obj, _ := QueryEmployeeInfos(ctx).OrderBy(node.EmployeeInfo().PrimaryKey()).Get()
		assertEqualFieldsEmployeeInfo(t, v_EmployeeInfo, obj)
	}
	if v_Login != nil {
		obj, _ := QueryLogins(ctx).OrderBy(node.Login().PrimaryKey()).Get()
		assertEqualFieldsLogin(t, v_Login, obj)
	}
	if v_Milestone != nil {
		obj, _ := QueryMilestones(ctx).OrderBy(node.Milestone().PrimaryKey()).Get()
		assertEqualFieldsMilestone(t, v_Milestone, obj)
	}
	assert.Equal(t, v_GiftCount, func() int { i, _ := CountGifts(ctx); return i }())
	assert.Equal(t, v_PersonCount, func() int { i, _ := CountPeople(ctx); return i }())
	assert.Equal(t, v_PersonWithLockCount, func() int { i, _ := CountPersonWithLocks(ctx); return i }())
	assert.Equal(t, v_ProjectCount, func() int { i, _ := CountProjects(ctx); return i }())
	assert.Equal(t, v_AddressCount, func() int { i, _ := CountAddresses(ctx); return i }())
	assert.Equal(t, v_EmployeeInfoCount, func() int { i, _ := CountEmployeeInfos(ctx); return i }())
	assert.Equal(t, v_LoginCount, func() int { i, _ := CountLogins(ctx); return i }())
	assert.Equal(t, v_MilestoneCount, func() int { i, _ := CountMilestones(ctx); return i }())
}
